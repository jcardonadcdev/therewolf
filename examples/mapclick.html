<!DOCTYPE html>
<html>
  <head lang="en">
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=10" />
    <meta name="viewport" content="initial-scale=1, maximum-scale=1,user-scalable=no"/>
    <title>Therewolf</title>
    <link rel="stylesheet" href="//js.arcgis.com/3.13/esri/css/esri.css">
    <link rel="stylesheet" href="//js.arcgis.com/3.13/dijit/themes/claro/claro.css">
    <style type="text/css">
      html, body {
        height: 100%; width: 100%;
        margin: 0; padding: 0;
      }
      body{
        background-color: #fff; overflow:hidden;
        font-family: sans-serif;
      }
      #map{
        width: 100%;
        height: 95%;
      }
    </style>
    <script>
      var dojoConfig = {
        isDebug: true,
        async: true,
        paths: {
          wolf: location.pathname.replace(/\/[^/]+$/, "").replace("examples", "")
        }
      };
    </script>
    <script src="//js.arcgis.com/3.13/"></script>
    <script>
      require([
            "esri/map",
          "esri/layers/FeatureLayer",
          "esri/geometry/webMercatorUtils",
        "wolf/therewolf",
        "dojo/on",
          "dojo/request",
        "dojo/domReady!"
      ], function(Map, FeatureLayer, webMercatorUtils, Therewolf, on, request){
        var app = {};

        function init(){
          var therewolf = new Therewolf();

          app.map = new Map("map", {
            basemap: "gray"
          });

          request("../data/statesFColl.json", {
            handleAs: "json"
          }).then(function(data){
            var layer = new FeatureLayer(data);
            app.map.addLayer(layer);

            therewolf.add("States", data);
            app.map.on("click", function(evt){
              var result;
              result = therewolf.find([evt.mapPoint.x,evt.mapPoint.y]).States;
              if(result){
                dojo.byId("txtState").innerHTML = result.STATE_NAME;
                //console.log("result: ", result.STATE_ABBR);
              }
              else{
                //console.log("no result");
                dojo.byId("txtState").innerHTML = "No Result";
              }
            });
          }, function(err){
            console.log("Error retrieving data: ", err);
          });
        }

        init();
      });
    </script>
  </head>
  <body>
    <div id="map"></div>
    <span>State you clicked on: </span><span id="txtState"></span>
  </body>
</html>
